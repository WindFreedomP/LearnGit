<!DOCTYPE html>
<!-- saved from url=(0041)http://c.biancheng.net/view/vip_7685.html -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" async="" charset="utf-8" src="./10.13C++处理输入输出错误_files/core.php"></script>

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
<!-- 启用Chromium高速渲染模式 -->
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<!-- 禁止百度转码 -->
<meta name="applicable-device" content="pc,mobile">
<meta name="MobileOptimized" content="width">
<meta name="HandheldFriendly" content="true">
<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
<!-- 禁止识别电话号码 -->
<meta name="format-detection" content="telephone=no">

<link rel="shortcut icon" href="http://c.biancheng.net/favicon.ico?v=1.6.72">
<link href="./10.13C++处理输入输出错误_files/common.css" rel="stylesheet">
<title>C++处理输入输出错误</title>
<meta name="description" content="当处理输入输出时，我们必须预计到其中可能发生的错误并给出相应的处理措施。 当我们输入时，可能会由于人的失误（错误理解了指令、打字错误、允许自家的小猫在键盘上散步等）">
</head>
<body>
<div id="topbar" class="clearfix">
	<ul id="product-type" class="left">
		<li>
			<a href="http://c.biancheng.net/"><span class="iconfont iconfont-home"></span>首页</a>
		</li>
		<li class="active">
			<a href="http://c.biancheng.net/sitemap/" rel="nofollow"><span class="iconfont iconfont-book"></span>教程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/vip/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-vip"></span>VIP会员</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/q2a/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-q2a"></span>一对一答疑</a>
		</li>
		<li>
			<a href="http://fudao.biancheng.net/" rel="nofollow" target="_blank"><span class="iconfont iconfont-fudao"></span>辅导班</a>
		</li>
	</ul>
</div>
<div id="header" class="clearfix">
	<a id="logo" class="left" href="http://c.biancheng.net/">
		<img height="26" src="./10.13C++处理输入输出错误_files/logo.png" alt="C语言中文网">
	</a>
	<ul id="nav-main" class="hover-none left clearfix">
		<li class="wap-yes"><a href="http://c.biancheng.net/">首页</a></li>
		<li><a href="http://c.biancheng.net/c/">C语言教程</a></li>
		<li><a href="http://c.biancheng.net/cplus/">C++教程</a></li>
		<li><a href="http://c.biancheng.net/python/">Python教程</a></li>
		<li><a href="http://c.biancheng.net/java/">Java教程</a></li>
		<li><a href="http://c.biancheng.net/linux_tutorial/">Linux入门</a></li>
		<li><a href="http://c.biancheng.net/sitemap/" title="网站地图">更多&gt;&gt;</a></li>
	</ul>
	<span id="sidebar-toggle" class="toggle-btn" toggle-target="#sidebar">目录 <span class="glyphicon"></span></span>

	<a href="http://vip.biancheng.net/?from=topbar" class="user-info glyphicon glyphicon-user hover-none" target="_blank" rel="nofollow" title="用户中心"></a>
</div>
<div id="main" class="clearfix">
	<div id="sidebar" class="toggle-target">
	<div id="contents">
		<dt><span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span><a href="http://c.biancheng.net/cplus/">C++</a></dt>
		
			<dd>
				<span class="channel-num">1</span>
				<a href="http://c.biancheng.net/cplus/c2cpp/">从C到C++</a>
			</dd>
		
			<dd>
				<span class="channel-num">2</span>
				<a href="http://c.biancheng.net/cplus/class/">类和对象</a>
			</dd>
		
			<dd>
				<span class="channel-num">3</span>
				<a href="http://c.biancheng.net/cplus/25/">C++引用</a>
			</dd>
		
			<dd>
				<span class="channel-num">4</span>
				<a href="http://c.biancheng.net/cplus/inherit/">继承与派生</a>
			</dd>
		
			<dd>
				<span class="channel-num">5</span>
				<a href="http://c.biancheng.net/cplus/polymorphism/">C++多态与虚函数</a>
			</dd>
		
			<dd>
				<span class="channel-num">6</span>
				<a href="http://c.biancheng.net/cplus/operator/">运算符重载</a>
			</dd>
		
			<dd>
				<span class="channel-num">7</span>
				<a href="http://c.biancheng.net/cplus/70/">模板</a>
			</dd>
		
			<dd>
				<span class="channel-num">8</span>
				<a href="http://c.biancheng.net/cplus/exception/">C++异常</a>
			</dd>
		
			<dd>
				<span class="channel-num">9</span>
				<a href="http://c.biancheng.net/cplus/100/">面向对象进阶</a>
			</dd>
		<dd class="this"> <span class="channel-num">10</span> <a href="http://c.biancheng.net/cplus/50/">输入输出流</a> </dd><dl class="dl-sub"><dd>10.1 <a href="http://c.biancheng.net/view/7559.html">什么是流，C++输入流和输出流</a></dd><dd>10.2 <a href="http://c.biancheng.net/view/3750.html">C++输出单个字符</a></dd><dd>10.3 <a href="http://c.biancheng.net/view/7585.html">C++输出字符串</a></dd><dd>10.4 <a href="http://c.biancheng.net/view/7587.html">C++ cout.tellp()和cout.seekp()方法</a></dd><dd>10.5 <a href="http://c.biancheng.net/view/7578.html">C++ cout格式化输出</a></dd><dd>10.6 <a href="http://c.biancheng.net/view/vip_7683.html">C++怎样对输入输出重定向？（3种方法）</a><span class="glyphicon glyphicon-usd"></span></dd><dd>10.7 <a href="http://c.biancheng.net/view/vip_7684.html">C++如何管理输出缓冲区？</a><span class="glyphicon glyphicon-usd"></span></dd><dd>10.8 <a href="http://c.biancheng.net/view/278.html">C++读取单个字符</a></dd><dd>10.9 <a href="http://c.biancheng.net/view/279.html">C++读入一行字符串</a></dd><dd>10.10 <a href="http://c.biancheng.net/view/vip_7686.html">C++如何跳过（忽略）指定字符？</a><span class="glyphicon glyphicon-usd"></span></dd><dd>10.11 <a href="http://c.biancheng.net/view/vip_7688.html">C++怎样查看输入流中的下一个字符？</a><span class="glyphicon glyphicon-usd"></span></dd><dd>10.12 <a href="http://c.biancheng.net/view/vip_7687.html">C++ cin是如何判断输入结束（读取结束）的？</a><span class="glyphicon glyphicon-usd"></span></dd><dd class="active">10.13 <a href="http://c.biancheng.net/view/vip_7685.html">C++处理输入输出错误</a><span class="glyphicon glyphicon-usd"></span></dd></dl>
			<dd>
				<span class="channel-num">11</span>
				<a href="http://c.biancheng.net/cplus/60/">文件操作</a>
			</dd>
		
			<dd>
				<span class="channel-num">12</span>
				<a href="http://c.biancheng.net/cplus/more_file/">C++多文件编程</a>
			</dd>
		
	</div>
</div>
	<div id="article-wrap">
		<div id="article">
			<div class="arc-info">
	<span class="position"><span class="glyphicon glyphicon-map-marker"></span> <a href="http://c.biancheng.net/">首页</a> &gt; <a href="http://c.biancheng.net/cplus/">C++</a> &gt; <a href="http://c.biancheng.net/cplus/50/">输入输出流</a></span>
	<span class="read-num">阅读：2,436</span>
</div>

<div id="ad-position-bottom"></div>
			<h1>C++处理输入输出错误</h1>
			<div class="pre-next-page clearfix">
                    <span class="pre left"><span class="icon">&lt;</span> <span class="text-brief text-brief-pre">上一页</span><a href="http://c.biancheng.net/view/vip_7687.html">C++ cin是如何判断输入结束（读取结束）的？</a></span>
                    <span class="next right"><a href="http://c.biancheng.net/cplus/60/">文件操作</a><span class="text-brief text-brief-next">下一页</span> <span class="icon">&gt;</span></span>
                </div>
			<div id="ad-arc-top"><p class="pic"></p><p class="text" adid="default"><a href="http://fudao.biancheng.net/" rel="nofollow" target="_blank" style="color:#D33428;">C语言中文网推出辅导班啦，包括<span style="color: #008000;">「C语言辅导班、C++辅导班、算法/数据结构辅导班」</span>，全部都是一对一教学：一对一辅导 + 一对一答疑 + 布置作业 + 项目实践 + 永久学习。QQ在线，随时响应！</a></p></div>
			<div id="arc-body">当处理输入输出时，我们必须预计到其中可能发生的错误并给出相应的处理措施。
<ul>
	<li>
		当我们输入时，可能会由于人的失误（错误理解了指令、打字错误、允许自家的小猫在键盘上散步等）、文件格式不符、错误估计了情况等原因造成读取失败。</li>
	<li>
		当我们输出时，如果输出设备不可用、队列满或者发生了故障等，都会导致写入失败。</li>
</ul>
<br>
发生输入输出错误的可能情况是无限的！但 C++ 将所有可能的情况归结为四类，称为流状态（stream state）。每种流状态都用一个 iostate 类型的标志位来表示。<br>
<br>
<table>
	<caption>
		流状态对应的标志位</caption>
	<tbody>
		<tr>
			<th>
				标志位</th>
			<th>
				意义</th>
		</tr>
		<tr>
			<td>
				badbit</td>
			<td>
				发生了（或许是物理上的）致命性错误，流将不能继续使用。</td>
		</tr>
		<tr>
			<td>
				eofbit</td>
			<td>
				输入结束（文件流的物理结束或用户结束了控制台流输入，例如用户按下了 Ctrl+Z 或 Ctrl+D 组合键。</td>
		</tr>
		<tr>
			<td>
				failbit</td>
			<td>
				I/O 操作失败，主要原因是非法数据（例如，试图读取数字时遇到字母）。流可以继续使用，但会设置&nbsp;failbit 标志。</td>
		</tr>
		<tr>
			<td>
				goodbit</td>
			<td>
				一切止常，没有错误发生，也没有输入结束。</td>
		</tr>
	</tbody>
</table>
<br>
ios_base 类定义了以上四个标志位以及 iostate 类型，但是&nbsp;ios 类又派生自 ios_base 类，所以可以使用 ios::failbit 代替&nbsp;ios_base::failbit 以节省输入。<br>
<br>
一旦流发生错误，对应的标志位就会被设置，我们可以通过下表列出的函数检测流状态。<br>
<br>
<table>
	<caption>
		C++流状态检测函数及其说明</caption>
	<tbody>
		<tr>
			<th>
				检测函数</th>
			<th>
				对应的标志位</th>
			<th>
				说明</th>
		</tr>
		<tr>
			<td>
				good()</td>
			<td>
				goodbit</td>
			<td>
				操作成功，没有发生任何错误。</td>
		</tr>
		<tr>
			<td>
				eof()</td>
			<td>
				eofbit</td>
			<td>
				到达输入末尾或文件尾。</td>
		</tr>
		<tr>
			<td>
				fail()</td>
			<td>
				failbit</td>
			<td>
				发生某些意外情况（例如，我们要读入一个数字，却读入了字符 'x'）。</td>
		</tr>
		<tr>
			<td>
				bad()</td>
			<td>
				badbit</td>
			<td>
				发生严重的意外（如磁盘读故障）。</td>
		</tr>
	</tbody>
</table>
<br>
不幸的是，fail() 和 bad() 之间的区别并未被准确定义，程序员对此的观点各种各样。但是，基本的思想很简单：
<ul>
	<li>
		如果输入操作遇到一个简单的格式错误，则使流进入 fail() 状态，也就是假定我们（输入操作的用户）可以从错误中恢复。</li>
	<li>
		如果错误真的非常严重，例如发生了磁盘故障，输入操作会使得流进入 bad() 状态。也就是假定面对这种情况你所能做的很有限，只能退出输入。</li>
</ul>
<br>
以上观点导致如下逻辑：
<div class="snippet-container" style="undefined;"><div class="sh_bright snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre><a class="snippet-copy sh_url" href="http://c.biancheng.net/view/vip_7685.html#" style="display: none;">复制</a><a class="snippet-text sh_url" href="http://c.biancheng.net/view/vip_7685.html#">纯文本</a><a class="snippet-window sh_url" href="http://c.biancheng.net/view/vip_7685.html#">复制</a></pre></div><pre class="cpp sh_cpp snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_type">int</span> i <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span></li><li>cin <span class="sh_symbol">&gt;&gt;</span> i<span class="sh_symbol">;</span></li><li><span class="sh_keyword">if</span><span class="sh_symbol">(!</span>cin<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>  <span class="sh_comment">//只有输入操作失败，才会跳转到这里</span></li><li>    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>cin<span class="sh_symbol">.</span><span class="sh_function">bad</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span>  <span class="sh_comment">//流发生严重故障，只能退出函数</span></li><li>        <span class="sh_function">error</span><span class="sh_symbol">(</span><span class="sh_string">"cin is bad!"</span><span class="sh_symbol">);</span>  <span class="sh_comment">//error是自定义函数，它抛出异常，并给出提示信息</span></li><li>    <span class="sh_cbracket">}</span></li><li>    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>cin<span class="sh_symbol">.</span><span class="sh_function">eof</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span>  <span class="sh_comment">//检测是否读取结束</span></li><li>        <span class="sh_comment">//TODO:</span></li><li>    <span class="sh_cbracket">}</span></li><li>    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>cin<span class="sh_symbol">.</span><span class="sh_function">fail</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span>  <span class="sh_comment">//流遇到了一些意外情况</span></li><li>        cin<span class="sh_symbol">.</span><span class="sh_function">clear</span><span class="sh_symbol">();</span> <span class="sh_comment">//清除/恢复流状态</span></li><li>        <span class="sh_comment">//TODO:</span></li><li>    <span class="sh_cbracket">}</span></li><li><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">int i = 0;
cin &gt;&gt; i;
if(!cin){  //只有输入操作失败，才会跳转到这里
    if(cin.bad()){  //流发生严重故障，只能退出函数
        error("cin is bad!");  //error是自定义函数，它抛出异常，并给出提示信息
    }
    if(cin.eof()){  //检测是否读取结束
        //TODO:
    }
    if(cin.fail()){  //流遇到了一些意外情况
        cin.clear(); //清除/恢复流状态
        //TODO:
    }
}</pre></div></div>
!cin 可以理解为“cin 不成功”或者“cin 发生了某些错误”或者“ cin 的状态不是 good()”， 这与“操作成功”正好相反，《<a href="http://c.biancheng.net/view/277.html" target="_blank">C++ cin判断输入结束</a>》一节中对此有详解。<br>
<br>
请注意我们在处理 fail() 时所使用的 cin.clear()。当流发生错误时，我们可以进行错误恢复。为了恢复错误，我们显式地将流从 fail() 状态转移到其他状态，从而可以继续从中读取字符。clear() 就起到这样的作用——执行 cin.clear() 后，cin 的状态就变为 good()。 <!-- <h2>
	修改标志位</h2>
一旦设置了流状态中的任何一个标志位，这些标志位将保持不变，但程序员并不希望总是保持这种状况。比如读取文件时，也许想在文件结束之前将文件内部指针重定位到开头的位置，但是仅靠移动文件内部指针不会自动重置 eofbit 或者 failbit 标志位。<br />
<br />
C++ 中有两个函数可以重置标志位，分别是 clear() 和 setstate()，下面分别讲解。
<h4>
	clear() 函数</h4>
clear() 函数有两个重载的版本：<br /> -->
<h2>
	实例</h2>
下面是一个如何使用流状态的例子。假定我们要读取一个整数序列并存入 vector 中，字符<code>*</code>或“文件尾”表示序列结束。Windows 平台按下 Ctrl+Z 组合键，再按下回车键表示到达文件末尾；类Unix系统按下 Ctrl+D 组合键表示到达文件末尾。<br>
<br>
上述功能可通过如下函数来实现：
<div class="snippet-container" style="undefined;"><div class="sh_bright snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre><a class="snippet-copy sh_url" href="http://c.biancheng.net/view/vip_7685.html#" style="display: none;">复制</a><a class="snippet-text sh_url" href="http://c.biancheng.net/view/vip_7685.html#">纯文本</a><a class="snippet-window sh_url" href="http://c.biancheng.net/view/vip_7685.html#">复制</a></pre></div><pre class="cpp sh_cpp snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_comment">//从 ist 中读入整数到 v 中，直到遇到 eof() 或终结符</span></li><li><span class="sh_type">void</span> <span class="sh_function">fill_vector</span><span class="sh_symbol">(</span>istream<span class="sh_symbol">&amp;</span> ist<span class="sh_symbol">,</span> vector<span class="sh_symbol">&lt;</span><span class="sh_type">int</span><span class="sh_symbol">&gt;&amp;</span> v<span class="sh_symbol">,</span> <span class="sh_type">char</span> terminator<span class="sh_symbol">)</span><span class="sh_cbracket">{</span></li><li>    <span class="sh_keyword">for</span><span class="sh_symbol">(</span> <span class="sh_type">int</span> i<span class="sh_symbol">;</span> ist<span class="sh_symbol">&gt;&gt;</span>i<span class="sh_symbol">;</span> <span class="sh_symbol">)</span> v<span class="sh_symbol">.</span><span class="sh_function">push_back</span><span class="sh_symbol">(</span>i<span class="sh_symbol">);</span></li><li><span style="display:none;">&nbsp;</span></li><li>    <span class="sh_comment">//正常情况</span></li><li>    <span class="sh_keyword">if</span><span class="sh_symbol">(</span>ist<span class="sh_symbol">.</span><span class="sh_function">eof</span><span class="sh_symbol">())</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>  <span class="sh_comment">//发现到了文件尾，正确，返回</span></li><li><span style="display:none;">&nbsp;</span></li><li>    <span class="sh_comment">//发生严重错误，只能退出函数</span></li><li>    <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>ist<span class="sh_symbol">.</span><span class="sh_function">bad</span><span class="sh_symbol">())</span><span class="sh_cbracket">{</span></li><li>        <span class="sh_function">error</span><span class="sh_symbol">(</span><span class="sh_string">"cin is bad!"</span><span class="sh_symbol">);</span>  <span class="sh_comment">//error是自定义函数，它抛出异常，并给出提示信息</span></li><li>    <span class="sh_cbracket">}</span></li><li><span style="display:none;">&nbsp;</span></li><li>    <span class="sh_comment">//发生意外情况</span></li><li>    <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>ist<span class="sh_symbol">.</span><span class="sh_function">fail</span><span class="sh_symbol">())</span> <span class="sh_cbracket">{</span>  <span class="sh_comment">//最好清除混乱，然后汇报问题</span></li><li>        ist<span class="sh_symbol">.</span><span class="sh_function">clear</span><span class="sh_symbol">();</span>  <span class="sh_comment">//清除流状态</span></li><li><span style="display:none;">&nbsp;</span></li><li>        <span class="sh_comment">//检测下一个字符是否是终结符</span></li><li>        <span class="sh_type">char</span> c<span class="sh_symbol">;</span></li><li>        ist<span class="sh_symbol">&gt;&gt;</span>c<span class="sh_symbol">;</span>  <span class="sh_comment">//读入一个符号，希望是终结符</span></li><li>        <span class="sh_keyword">if</span><span class="sh_symbol">(</span>c <span class="sh_symbol">!=</span> terminator<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span> <span class="sh_comment">// 非终结符</span></li><li>            ist<span class="sh_symbol">.</span><span class="sh_function">unget</span><span class="sh_symbol">();</span> <span class="sh_comment">//放回该符号</span></li><li>            ist<span class="sh_symbol">.</span><span class="sh_function">clear</span><span class="sh_symbol">(</span>ios_base<span class="sh_symbol">::</span>failbit<span class="sh_symbol">);</span>  <span class="sh_comment">//将流状态设置为 fail()</span></li><li>        <span class="sh_cbracket">}</span></li><li>    <span class="sh_cbracket">}</span></li><li><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">//从 ist 中读入整数到 v 中，直到遇到 eof() 或终结符
void fill_vector(istream&amp; ist, vector&lt;int&gt;&amp; v, char terminator){
    for( int i; ist&gt;&gt;i; ) v.push_back(i);

    //正常情况
    if(ist.eof()) return;  //发现到了文件尾，正确，返回

    //发生严重错误，只能退出函数
    if (ist.bad()){
        error("cin is bad!");  //error是自定义函数，它抛出异常，并给出提示信息
    }

    //发生意外情况
    if (ist.fail()) {  //最好清除混乱，然后汇报问题
        ist.clear();  //清除流状态

        //检测下一个字符是否是终结符
        char c;
        ist&gt;&gt;c;  //读入一个符号，希望是终结符
        if(c != terminator) { // 非终结符
            ist.unget(); //放回该符号
            ist.clear(ios_base::failbit);  //将流状态设置为 fail()
        }
    }
}</pre></div></div>
如果发生了&nbsp;fail()，我们尝试检测下一个字符是否是结束符：如果是，那么就完整得读取了数据，使用 clear() 恢复状态就可以；如果不是，我们就没有办法处理了，所以将状态重新设置为 fail()，以期望 fill_vector() 的调用者（上层函数）有能力处理。<br>
<br>
我们通过调用 ist.clear(ios_base::failbit) 来将流状态设置为 fail()。对照简单的cleal()，带参数的用法有些令人迷惑：当 clear() 带参数时，参数中所指出的 iostream 状态位会被置位（进入相应状态)，而未指出的状态位会被复位。通过将流状态设置为 fail()，我们表明遇到了一个格式错误，而不是一个更为严重的问题。<br>
<br>
可以用 unget() 将字符放回 ist，以便 fill_vector() 的调用者可能使用该字符。unget() 函数是 putback() 的简化版本，它依赖于流对象记住最后一个字符是什么，所以在这里可以不用考虑它的用法。<br>
<br>
如果 fill_vector() 的调用者想知道是什么原因终止了输入，那么可以检测流是处于 fail() 还是 eof() 状态。当然也可以捕获 error() 抛出的 runtime_error 异常，但当 istream 处于 bad() 状态时，继续获取数据是不可能的。大多数的调用者无须为此烦恼。因为这意味着，几乎在所有情况下，对于 bad() 状态，我们所能做的只是抛出一个异常。<br>
<br>
简单起见，可以让 istream 帮我们抛出这个异常。
<p class="info-box">
	//当 ist 出现问题时拋出异常<br>
	ist.exceptions(ist.exceptions() | ios_base:: badbit);</p>
这样的写法也许看起来有些奇怪，但结果却很简单，当此语句执行时，如果 ist 处于 bad() 状态，它会抛出一个标准库异常 ios_base::failure。在一个程序中，我们只需要调用 exceptions() 一次。这允许我们简化关联于 ist 的所有输入过程，同时忽略对 bad() 的处理：
<div class="snippet-container" style="undefined;"><div class="sh_bright snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre><a class="snippet-copy sh_url" href="http://c.biancheng.net/view/vip_7685.html#" style="display: none;">复制</a><a class="snippet-text sh_url" href="http://c.biancheng.net/view/vip_7685.html#">纯文本</a><a class="snippet-window sh_url" href="http://c.biancheng.net/view/vip_7685.html#">复制</a></pre></div><pre class="cpp sh_cpp snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_comment">//从ist中读入整数到v中，直到遇到eof()或终结符</span></li><li><span class="sh_type">void</span> <span class="sh_function">fill_vector</span><span class="sh_symbol">(</span>istream<span class="sh_symbol">&amp;</span> ist<span class="sh_symbol">,</span> vector<span class="sh_symbol">&lt;</span><span class="sh_type">int</span><span class="sh_symbol">&gt;&amp;</span> v<span class="sh_symbol">,</span> <span class="sh_type">char</span> terminator<span class="sh_symbol">)</span><span class="sh_cbracket">{</span></li><li>    ist<span class="sh_symbol">.</span><span class="sh_function">exceptions</span><span class="sh_symbol">(</span>ist<span class="sh_symbol">.</span><span class="sh_function">exceptions</span><span class="sh_symbol">()</span> <span class="sh_symbol">|</span> ios_base<span class="sh_symbol">::</span> badbit<span class="sh_symbol">);</span></li><li><span style="display:none;">&nbsp;</span></li><li>    <span class="sh_keyword">for</span> <span class="sh_symbol">(</span><span class="sh_type">int</span> i<span class="sh_symbol">;</span> ist<span class="sh_symbol">&gt;&gt;</span>i<span class="sh_symbol">;</span> <span class="sh_symbol">)</span> v<span class="sh_symbol">.</span><span class="sh_function">push_back</span><span class="sh_symbol">(</span>i<span class="sh_symbol">);</span></li><li><span style="display:none;">&nbsp;</span></li><li>    <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>ist<span class="sh_symbol">.</span><span class="sh_function">eof</span><span class="sh_symbol">())</span> <span class="sh_keyword">return</span><span class="sh_symbol">;</span>  <span class="sh_comment">//发现到了文件尾</span></li><li><span style="display:none;">&nbsp;</span></li><li>    <span class="sh_comment">//不是good()，不是bad()，不是eof()，ist的状态一定是fail()</span></li><li>    ist<span class="sh_symbol">.</span><span class="sh_function">clear</span><span class="sh_symbol">();</span>  <span class="sh_comment">//清除流状态</span></li><li><span style="display:none;">&nbsp;</span></li><li>    <span class="sh_type">char</span> c<span class="sh_symbol">;</span></li><li>    ist<span class="sh_symbol">&gt;&gt;</span>c<span class="sh_symbol">;</span>    <span class="sh_comment">//读入一个符号，希望是终结符</span></li><li>    <span class="sh_keyword">if</span> <span class="sh_symbol">(</span>c <span class="sh_symbol">!=</span> terminator<span class="sh_symbol">)</span> <span class="sh_cbracket">{</span> <span class="sh_comment">//不是终结符号，一定是失败了</span></li><li>        ist<span class="sh_symbol">.</span><span class="sh_function">unget</span><span class="sh_symbol">();</span>    <span class="sh_comment">//也许程序调用者可以使用这个符号</span></li><li>        ist<span class="sh_symbol">.</span><span class="sh_function">clear</span><span class="sh_symbol">(</span>ios_base<span class="sh_symbol">::</span>failbit<span class="sh_symbol">);</span> <span class="sh_comment">//将流状态设置为 fail()</span></li><li>    <span class="sh_cbracket">}</span></li><li><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">//从ist中读入整数到v中，直到遇到eof()或终结符
void fill_vector(istream&amp; ist, vector&lt;int&gt;&amp; v, char terminator){
    ist.exceptions(ist.exceptions() | ios_base:: badbit);

    for (int i; ist&gt;&gt;i; ) v.push_back(i);

    if (ist.eof()) return;  //发现到了文件尾

    //不是good()，不是bad()，不是eof()，ist的状态一定是fail()
    ist.clear();  //清除流状态

    char c;
    ist&gt;&gt;c;    //读入一个符号，希望是终结符
    if (c != terminator) { //不是终结符号，一定是失败了
        ist.unget();    //也许程序调用者可以使用这个符号
        ist.clear(ios_base::failbit); //将流状态设置为 fail()
    }
}</pre></div></div>
这里使用了 ios_base，它是 iostream 的一部分，包含了对常量如 badbit 的定义、异常如 failure 的定义，以及其他一些有用的定义。可以通过<code>::</code>操作符来使用它们，例如 ios_ base::badbit。<br>
<br>
我们无须如此深入地讨论 iostream 库的细节，若要学习 iostream的所有内容，可能需要一门完整的课程。例如，iostream 可以处理不同的字符集，实现不同的缓冲策略，还包含一些工具，能按不同语言的习惯格式化货币金额的输入输出。我们曾经收到过一份关于乌克兰货币输入输出格式的错误报告。如果需要了解更多 iostream 库的内容，可以参考 Stroustrup 的《The C++ Programming Language》和 Langer 的《Standard C++ IOStreams and Locales》。<br>
<br>
与 istream—样，ostream 也有四个状态：good()、fail()、eof() 和 bad()。不过，对于本教程的读者来说，输出错误要比输入错误少得多，因此通常不对 ostream 进行状态检测。如果程序运行环境中输出设备不可用、队列满或者发生故障的概率很高，我们就可以像处理输入操作那样，在每次输出操作之后都检测其状态。</div>
			<div id="arc-append">
	<p>关注微信公众号「站长严长生」，在手机上阅读所有教程，随时随地都能学习。本公众号由<a class="col-link" href="http://c.biancheng.net/view/8092.html" target="_blank" rel="nofollow">C语言中文网站长</a>运营，每日更新，坚持原创，敢说真话，凡事有态度。</p>
	<p style="margin-top:12px; text-align:center;">
		<img width="180" src="./10.13C++处理输入输出错误_files/qrcode_weixueyuan_original.png" alt="魏雪原二维码"><br>
		<span class="col-green">微信扫描二维码关注公众号</span>
	</p>
</div>
<!-- <p>关注微信公众号「魏雪原」，跟着<a class="col-link" href="/view/8092.html" target="_blank">站长</a>一起学习，拒绝躺平，跳出内卷，用知识完成阶级跃升：</p>
	<ul>
		<li>每日更新，坚持原创，敢说真话，凡事有态度。</li>
		<li>编程+求职+创业+营销，既有硬知识，也有软技能。</li>
		<li>手机端阅读教程，随时随地都能学习。</li>
		<li>即将绑定网站部分功能，包括注册登录、找回密码、获取下载链接等。</li>
	</ul> -->
			<div class="pre-next-page clearfix">
                    <span class="pre left"><span class="icon">&lt;</span> <span class="text-brief text-brief-pre">上一页</span><a href="http://c.biancheng.net/view/vip_7687.html">C++ cin是如何判断输入结束（读取结束）的？</a></span>
                    <span class="next right"><a href="http://c.biancheng.net/cplus/60/">文件操作</a><span class="text-brief text-brief-next">下一页</span> <span class="icon">&gt;</span></span>
                </div>
			<div id="ad-arc-bottom"></div>

<!-- <div id="ad-bottom-weixin" class="clearfix">
	<div class="left" style="width: 535px;">
		<p><span class="col-red">编程帮</span>，一个分享编程知识的公众号。跟着<a class="col-link" href="/cpp/about/author/" target="_blank">站长</a>一起学习，每天都有进步。</p>
		<p>通俗易懂，深入浅出，一篇文章只讲一个知识点。</p>
		<p>文章不深奥，不需要钻研，在公交、在地铁、在厕所都可以阅读，随时随地涨姿势。</p>
		<p>文章不涉及代码，不烧脑细胞，人人都可以学习。</p>
		<p>当你决定关注「编程帮」，你已然超越了90%的程序员！</p>
	</div>
	<div class="right" style="width: 150px;">
		<img width="150" src="/templets/new/images/erweima_biancheng.gif?v=1.6.72" alt="编程帮二维码" /><br />
		<span class="col-green">微信扫描二维码关注</span>
	</div>
</div> -->

<div id="nice-arcs" class="box-bottom">
	<h4>优秀文章</h4>
	<ul class="clearfix">
<li><a href="http://c.biancheng.net/view/1175.html" title="多道程序设计和分时系统">多道程序设计和分时系统</a></li>
<li><a href="http://c.biancheng.net/view/1655.html" title="吉林大学微机原理及汇编语言视频教程（80集全+5集辅导课）">吉林大学微机原理及汇编语言视频教程（80集全+5集辅导课）</a></li>
<li><a href="http://c.biancheng.net/view/1944.html" title="TensorFlow WaveNet声音合成详解">TensorFlow WaveNet声音合成详解</a></li>
<li><a href="http://c.biancheng.net/view/3491.html" title="Google Play Store（ Android Market）发布简介">Google Play Store（ Android Market）发布简介</a></li>
<li><a href="http://c.biancheng.net/c/abs.html" title="C语言abs()函数：求整数的绝对值">C语言abs()函数：求整数的绝对值</a></li>
<li><a href="http://c.biancheng.net/view/4307.html" title="Go语言sync包与锁：限制线程对变量的访问">Go语言sync包与锁：限制线程对变量的访问</a></li>
<li><a href="http://c.biancheng.net/view/5459.html" title="JS !（非运算）详解">JS !（非运算）详解</a></li>
<li><a href="http://c.biancheng.net/view/5607.html" title="Java程序的运行过程（执行流程）分析">Java程序的运行过程（执行流程）分析</a></li>
<li><a href="http://c.biancheng.net/view/8227.html" title="JS获取父节点和兄弟节点">JS获取父节点和兄弟节点</a></li>
<li><a href="http://c.biancheng.net/redis/cache.html" title="Redis缓存问题（图解：三种缓存问题）">Redis缓存问题（图解：三种缓存问题）</a></li>
</ul>
</div>
		</div>
		
	</div>
</div>
<script type="text/javascript">
// 当前文章ID
window.arcIdRaw = 'a_' + 7685;
window.arcId = "4d28KlkD7xsjsf1BA4rayqiQlUdvfvgbanjnjwSfEgWwC2d3YqjlQeFA1qw";
window.typeidChain = "43|19";
</script>
<div id="footer" class="clearfix">
	<div class="info left">
	<p>精美而实用的网站，分享优质编程教程，帮助有志青年。千锤百炼，只为大作；精益求精，处处斟酌；这种教程，看一眼就倾心。</p>
	<p>
		<a href="http://c.biancheng.net/view/8066.html" target="_blank" rel="nofollow">关于网站</a> <span>|</span>
		<a href="http://c.biancheng.net/view/8092.html" target="_blank" rel="nofollow">关于站长</a> <span>|</span>
		<a href="http://c.biancheng.net/view/8097.html" target="_blank" rel="nofollow">如何完成一部教程</a> <span>|</span>
		<a href="http://c.biancheng.net/view/8093.html" target="_blank" rel="nofollow">联系我们</a> <span>|</span>
		<a href="http://c.biancheng.net/sitemap/" target="_blank" rel="nofollow">网站地图</a>
	</p>
	<p>Copyright ©2012-2021 biancheng.net, <a href="http://www.beian.miit.gov.cn/" target="_blank" rel="nofollow" style="color:#666;">陕ICP备15000209号</a></p>
	</div>
	<img class="right" src="./10.13C++处理输入输出错误_files/logo_bottom.gif" alt="底部Logo">
	<span id="return-top"><b>↑</b></span>
</div>

<script type="text/javascript">
window.siteId = 4;
window.cmsTemplets = "/templets/new";
window.cmsTempletsVer = "1.6.72";
</script>

<script src="./10.13C++处理输入输出错误_files/jquery1.12.4.min.js.下载"></script>
<script src="./10.13C++处理输入输出错误_files/common.js.下载"></script>
<span style="display:none;"><script src="./10.13C++处理输入输出错误_files/z_stat.php" type="text/javascript" defer="defer" async="async"></script></span>

</body></html>